(()=>{var e={373:()=>{}},t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}(()=>{"use strict";var e=function(){function e(e,t,n){this.premises=e,this.conslusion=t,this.origin=n}return e.prototype.applicable=function(e){return this.premises.every((function(t){return e.has(t)}))},e}();function t(e,t,n){var o=new Map(t.map((function(e){return[e,null]})));return a(e,o,n)?r(o,n):void 0}function r(e,t,n){void 0===n&&(n=new Set);var a=e.get(t);return!a||n.has(t)?[]:(n.add(t),a.premises.map((function(t){return r(e,t,n)})).reduce((function(e,t){return e.concat(t)}),[]).concat([a]))}function a(e,t,n,r){if(void 0===r&&(r=new Set),t.has(n))return!0;if(r.has(n))return!1;r.add(n);var o=e.filter((function(e){return e.conslusion===n}));e:for(var i=0;i<o.length;i++){for(var c=o[i],u=0;u<c.premises.length;u++)if(!a(e,t,c.premises[u],r))continue e;return t.set(n,c),r.delete(n),!0}return r.delete(n),!1}var o={Edit:i('<path d="M30 7 L25 2 5 22 3 29 10 27 Z M21 6 L26 11 Z M5 22 L10 27 Z" />',"i-edit"),Language:i('<path d="M10 9 L3 17 10 25 M22 9 L29 17 22 25 M18 7 L14 27" />',"i-code"),Delete:i('<path d="M28 6 L6 6 8 30 24 30 26 6 4 6 M16 12 L16 24 M21 12 L20 24 M11 12 L12 24 M12 6 L13 2 19 2 20 6" />',"i-trash"),Add:i('<path d="M16 2 L16 30 M2 16 L30 16" />',"i-plus")};function i(e,t,n){return void 0===n&&(n=24),'<svg id="'+t+'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="'+n+'" height="'+n+'" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1">'+e+"</svg>"}var c,u=function(){function e(e,t,n){this.button=document.createElement("button"),this.button.innerHTML=t,this.button.addEventListener("click",(function(e){n(),e.preventDefault()})),e.append(this.button)}return Object.defineProperty(e.prototype,"visible",{set:function(e){this.button.style.display=e?"":"none"},enumerable:!1,configurable:!0}),e.prototype.click=function(){this.button.click()},e}();function s(e,t){var n=document.createElement("form");n.addEventListener("submit",(function(e){return e.preventDefault()}));var r=document.createElement("header");r.innerText="Факты",r.title="(ЛКМ - как начальный факт, ПКМ - как искомый)";var a=document.createElement("article");a.classList.add("selectable-list");var i=new Array,s=new Array;new u(r,o.Delete,(function(){return Array().concat(i,s).forEach((function(e){return e.checked=!1}))})),a.append.apply(a,Array.from(e.entries()).sort((function(e,t){return e[1].localeCompare(t[1])})).map((function(e){var t=e[0],n=e[1],r=document.createElement("section");r.classList.add("selectable-line"),r.title=t;var a=document.createElement("input");a.value=t,a.name="isInitial",a.type="checkbox";var o=document.createElement("input");return o.value=t,o.name="isTarget",o.type="radio",r.append(a,n,o),i.push(a),s.push(o),r.addEventListener("mouseup",(function(e){if(e.target==r)switch(e.button){case 0:(a.checked=!a.checked)&&(o.checked=!1);break;case 2:(o.checked=!o.checked)&&(a.checked=!1)}})),r.addEventListener("contextmenu",(function(e){return e.preventDefault()})),r})));("last",new Promise((function(e,t){var n,r=new URL(window.location.href).searchParams.get("data");if(r)try{var a=(n=r,decodeURIComponent(escape(window.atob(n))));return console.log(a),e(JSON.parse(a))}catch(e){console.log(e)}var o=window.localStorage.getItem("last");o&&e(JSON.parse(o))}))).then((function(e){var t=e.initial,n=e.target,r=new Set(t);i.filter((function(e){return r.has(e.value)})).forEach((function(e){return e.checked=!0})),s.filter((function(e){return e.value===n})).forEach((function(e){return e.checked=!0}))}));var l=document.createElement("footer");return l.append.apply(l,[["Прямой",c.Forward],["Обратный",c.Backward]].map((function(e){var n=e[0],r=e[1],a=document.createElement("button");return a.innerText=n,a.addEventListener("click",function(e){return function(n){var r=s.find((function(e){return e.checked}));if(null!=r){var a=i.filter((function(e){return e.checked}));if(0!=a.length){var o=a.map((function(e){return e.value})),c=r.value,u=JSON.stringify({initial:o,target:c});console.log(u),window.localStorage.setItem("last",u);var l,d=new URL(window.location.href);d.searchParams.set("data",(l=u,window.btoa(unescape(encodeURIComponent(l))))),history.pushState(null,"",d.toString()),t(e,o,c)}else alert("Выберите начальные факты")}else alert("Выберите целевой факт")}}(r)),a}))),n.append(r,a,l),n}function l(e,t,n,r,a,o){n.innerHTML="";var i=function(t){var n=document.createElement("span");n.textContent=e.get(t);var r=t.replace(/[)(]/g,"_");return n.classList.add(r),(null==o?void 0:o.has(t))&&n.classList.add("initial-fact"),n.addEventListener("mouseenter",(function(){return a.textContent="."+r+" { background-color: #383a42; font-weight: 700; } .reaction > ."+r+" { outline: dashed 2px lime; }"})),n};n.append.apply(n,t.map((function(e){var t=document.createElement("div");return t.title=e.origin,t.classList.add("reaction"),t.append.apply(t,e.premises.map(i).reduce((function(e,t){return e.length?e.concat(" + ",t):[t]}),new Array)),t.append(" → ",i(e.conslusion)),t.classList.add(e.conslusion.replace(/[)(]/g,"_")),t}))),r.textContent="Правил: "+t.length}!function(e){e[e.Forward=0]="Forward",e[e.Backward=1]="Backward"}(c||(c={})),n(373),Promise.all(["Substances","Chemistry"].map((function(e){return"./resources/"+e+".txt"})).map((function(e){return fetch(e,{method:"GET",headers:{"Content-Type":"text/plain"}}).then((function(e){return e.text()}))}))).then((function(n){var r,a=n[0],o=n[1],i=new Map,u=new Set;a.split("\n").filter((function(e){return""!=e.trim()})).map((function(e){return e.split(" -> ")})).forEach((function(e){return i.set(e[0].trim(),e[1].trim())})),null===(r=o.match(/[A-Za-zС0-9А-Яа-я()]+/g))||void 0===r||r.forEach((function(e){i.get(e)||(u.add(e),i.set(e,e))}));var d=o.split("\n").map((function(e){return e.trim()})).filter((function(e){return""!=e})).map((function(t){var n=t.split(" -> ").map((function(e){return e.split("+").map((function(e){return e.trim()}))})),r=n[0];return n[1].map((function(n){return new e(r,n,t)}))})).reduce((function(e,t){return e.concat(t)}),[]);d.sort((function(e,t){return e.premises.length-t.premises.length}));var p=document.createElement("style");document.body.appendChild(p);var f=document.createElement("article"),m=document.createElement("article"),h=document.createElement("header"),v=document.createElement("section"),w=document.createElement("footer"),g=document.createElement("button");g.textContent="Все правила",g.addEventListener("click",(function(){return l(i,d,m,v,p)})),w.append(v,g),h.textContent="Вывод:",f.append(h,m,w),f.id="output";var L=s(i,(function(e,n,r){try{m.innerHTML="";var a=e==c.Forward?function(e,t,n){for(var r=new Array,a=new Set(e),o=new Set(t);!o.has(n);){var i=Array.from(a.keys()).find((function(e){return e.applicable(o)&&!o.has(e.conslusion)}));if(!i)return;r.push(i),a.delete(i),o.add(i.conslusion)}return r}(d,n,r):t(d,n,r);a?l(i,a,m,v,p,new Set(n)):v.textContent="Не выводимо"}catch(e){v.textContent=e}}));m.innerHTML='<div style="text-align: center;">Справа можно выбрать начальные факты и конечный факт (с помощью чекбоксов или ЛКМ и ПКМ по строчке).<div>',document.querySelector("article").append(f,L)}))})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yZXZlcmlzLWZyb250L3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3JldmVyaXMtZnJvbnQvLi9zcmMvZGVkdWNlcy50cyIsIndlYnBhY2s6Ly9yZXZlcmlzLWZyb250Ly4vc3JjL3N2Zy50cyIsIndlYnBhY2s6Ly9yZXZlcmlzLWZyb250Ly4vc3JjL2ZhY3RzX3NlbGVjdG9yLnRzIiwid2VicGFjazovL3JldmVyaXMtZnJvbnQvLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vcmV2ZXJpcy1mcm9udC8uL3NyYy9odHRwX2hlbHBlcnMudHMiXSwibmFtZXMiOlsiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJwcmVtaXNlcyIsImNvbnNsdXNpb24iLCJvcmlnaW4iLCJhcHBsaWNhYmxlIiwiZmFjdHMiLCJ0aGlzIiwiZXZlcnkiLCJwcmVtaXNlIiwiaGFzIiwiQmFja3dhcmREZWR1Y2UiLCJydWxlcyIsImluaXRpYWwiLCJ0YXJnZXQiLCJhZ2VudGEiLCJNYXAiLCJtYXAiLCJmIiwiYmFja3dhcmREZWR1Y2UiLCJyZXN0b3JlUmVzdWx0IiwidW5kZWZpbmVkIiwiY2FjaGUiLCJTZXQiLCJydWxlIiwiZ2V0IiwiYWRkIiwicCIsInJlZHVjZSIsImFjYyIsIngiLCJjb25jYXQiLCJzZWFyY2giLCJjYW5kaWRhdGVzIiwiZmlsdGVyIiwibmV4dFJ1bGUiLCJpIiwibGVuZ3RoIiwiY2FuZGlkYXRlUnVsZSIsImoiLCJzZXQiLCJkZWxldGUiLCJTVkdQaWN0dXJlcyIsIkVkaXQiLCJtYWtlU1ZHIiwiTGFuZ3VhZ2UiLCJEZWxldGUiLCJBZGQiLCJzb3VyY2UiLCJpZCIsInNpemUiLCJEaXJlY3Rpb24iLCJwYXJlbnROb2RlIiwic3ZnIiwib25jbGljayIsImJ1dHRvbiIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldiIsInByZXZlbnREZWZhdWx0IiwiYXBwZW5kIiwidmlzaWJsZSIsInN0eWxlIiwiZGlzcGxheSIsImNsaWNrIiwiY3JlYXRlRmFjdHNTZWxlY3RvciIsIm5hbWVzIiwiY2hvb3NlZCIsImNob29zZUl0ZW1zIiwiaGVhZGVyIiwiaW5uZXJUZXh0IiwidGl0bGUiLCJpdGVtcyIsImNsYXNzTGlzdCIsImluaXRpYWxJbnB1dHMiLCJBcnJheSIsInRhcmdldElucHV0cyIsIkNsaWNrYWJsZVNWR0J1dHRvbiIsImZvckVhY2giLCJpbnB1dCIsImNoZWNrZWQiLCJmcm9tIiwiZW50cmllcyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJuYW1lIiwibGluZSIsImlzSW5pdGlhbCIsInZhbHVlIiwidHlwZSIsImlzVGFyZ2V0IiwicHVzaCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwic3RyIiwicGFyYW0iLCJVUkwiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhyZWYiLCJzZWFyY2hQYXJhbXMiLCJqc29uIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiZXNjYXBlIiwiYXRvYiIsImNvbnNvbGUiLCJsb2ciLCJKU09OIiwicGFyc2UiLCJlIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInRoZW4iLCJzYXZlZEluaXRpYWwiLCJmb290ZXIiLCJGb3J3YXJkIiwiQmFja3dhcmQiLCJkaXIiLCJ0YXJnZXRGYWN0IiwiZmluZCIsImluaXRpYWxGYWN0cyIsImluaXRpYWxGYWN0c0lkcyIsInRhcmdldEZhY3RJZCIsImpzb25TbmFwc2hvdCIsInN0cmluZ2lmeSIsInNldEl0ZW0iLCJ1cmwiLCJidG9hIiwidW5lc2NhcGUiLCJlbmNvZGVVUklDb21wb25lbnQiLCJoaXN0b3J5IiwicHVzaFN0YXRlIiwidG9TdHJpbmciLCJhbGVydCIsImNyZWF0ZUV2ZW50IiwicHJpbnRSdWxlcyIsInJlc3VsdCIsIm91dHB1dCIsIm91dHB1dEZvb3RlciIsInN0eWxlU2hlZXQiLCJpbml0aWFsU2V0IiwiZmFjdFRvU3BhbiIsImZhY3RJZCIsIndyYXBwZXIiLCJ0ZXh0Q29udGVudCIsInNlcmlhbGl6ZWRJZCIsInJlcGxhY2UiLCJyIiwicmVhY3Rpb24iLCJuZXh0IiwiYWxsIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwicmVzcG9uc2UiLCJ0ZXh0Iiwic3Vic3RhbmNlcyIsInJlYWN0aW9ucyIsIm5vdEZvdW5kIiwic3BsaXQiLCJ0cmltIiwicyIsInBhaXIiLCJtYXRjaCIsInN1YnN0ciIsInJhd1J1bGUiLCJjIiwiUnVsZSIsImJvZHkiLCJhcHBlbmRDaGlsZCIsIm91dHB1dEFydGljbGUiLCJvdXRwdXRIZWFkZXIiLCJzZWVSdWxlcyIsInByb2Nlc3NlZCIsInVucHJvY2Vzc2VkIiwia2V5cyIsIkZvcndhcmREZWR1Y2UiLCJxdWVyeVNlbGVjdG9yIl0sIm1hcHBpbmdzIjoieUJBQ0lBLEVBQTJCLEdBRy9CLFNBQVNDLEVBQW9CQyxHQUU1QixHQUFHRixFQUF5QkUsR0FDM0IsT0FBT0YsRUFBeUJFLEdBQVVDLFFBRzNDLElBQUlDLEVBQVNKLEVBQXlCRSxHQUFZLENBR2pEQyxRQUFTLElBT1YsT0FIQUUsRUFBb0JILEdBQVVFLEVBQVFBLEVBQU9ELFFBQVNGLEdBRy9DRyxFQUFPRCxRLG1CQ3BCZixpQkFDSSxXQUNvQkcsRUFDQUMsRUFDQUMsR0FGQSxLQUFBRixXQUNBLEtBQUFDLGFBQ0EsS0FBQUMsU0FJeEIsT0FIVyxZQUFBQyxXQUFQLFNBQWtCQyxHQUNkLE9BQU9DLEtBQUtMLFNBQVNNLE9BQU0sU0FBQ0MsR0FBWSxPQUFBSCxFQUFNSSxJQUFJRCxPQUUxRCxFQVJBLEdBMEJPLFNBQVNFLEVBQWVDLEVBQWVDLEVBQW1CQyxHQUM3RCxJQUFNQyxFQUFTLElBQUlDLElBQXVCSCxFQUFRSSxLQUFJLFNBQUFDLEdBQUcsT0FBQ0EsRUFBRyxVQUM3RCxPQUFPQyxFQUFlUCxFQUFPRyxFQUFRRCxHQUFVTSxFQUFjTCxFQUFRRCxR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aEJzRyxFQUFjLElBQUk1SixJQUFJWCxHQUN0QkcsRUFBUyxJQUFJUSxJQUFJVixJQUNmRSxFQUFPTCxJQUFJSSxJQUFTLENBQ3hCLElBQU1VLEVBQU9xRCxNQUFNTSxLQUFLZ0csRUFBWUMsUUFBUXhELE1BQUssU0FBQTRCLEdBQUssT0FBQUEsRUFBRW5KLFdBQVdVLEtBQVlBLEVBQU9MLElBQUk4SSxFQUFFckosZUFDNUYsSUFBS3FCLEVBQ0QsT0FFSjBKLEVBQVVuRixLQUFLdkUsR0FDZjJKLEVBQVkxSSxPQUFPakIsR0FDbkJULEVBQU9XLElBQUlGLEVBQUtyQixZQUVwQixPQUFPK0ssRUdzQjJDRyxDQUFjekssRUFBT0MsRUFBU0MsR0FBVUgsRUFBZUMsRUFBT0MsRUFBU0MsR0FDN0crSCxFQUNBRCxFQUFXdEksRUFBT3VJLEVBQVFDLEVBQVFDLEVBQWNDLEVBQVksSUFBSXpILElBQUlWLElBRXBFa0ksRUFBYU0sWUFBYyxjQUNqQyxNQUFPbkMsR0FDTDZCLEVBQWFNLFlBQWNuQyxNQUduQzRCLEVBQU9wRixVQUFZLDZJQUNuQkYsU0FBUzhILGNBQWMsV0FBWXhILE9BQU9pSCxFQUFlekcsTyIsImZpbGUiOiJtYWluLmJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdGlmKF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0pIHtcblx0XHRyZXR1cm4gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiZXhwb3J0IGNsYXNzIFJ1bGUge1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IHByZW1pc2VzOiBzdHJpbmdbXSxcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgY29uc2x1c2lvbjogc3RyaW5nLFxyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBvcmlnaW46IHN0cmluZykgeyB9XHJcbiAgICBwdWJsaWMgYXBwbGljYWJsZShmYWN0czogU2V0PHN0cmluZz4pOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wcmVtaXNlcy5ldmVyeSgocHJlbWlzZSkgPT4gZmFjdHMuaGFzKHByZW1pc2UpKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIEZvcndhcmREZWR1Y2UocnVsZXM6IFJ1bGVbXSwgaW5pdGlhbDogc3RyaW5nW10sIHRhcmdldDogc3RyaW5nKTogUnVsZVtdIHwgdW5kZWZpbmVkIHtcclxuICAgIGNvbnN0IHByb2Nlc3NlZCA9IG5ldyBBcnJheTxSdWxlPigpO1xyXG4gICAgY29uc3QgdW5wcm9jZXNzZWQgPSBuZXcgU2V0KHJ1bGVzKTtcclxuICAgIGNvbnN0IGFnZW50YSA9IG5ldyBTZXQoaW5pdGlhbCk7XHJcbiAgICB3aGlsZSAoIWFnZW50YS5oYXModGFyZ2V0KSkge1xyXG4gICAgICAgIGNvbnN0IHJ1bGUgPSBBcnJheS5mcm9tKHVucHJvY2Vzc2VkLmtleXMoKSkuZmluZChyID0+IHIuYXBwbGljYWJsZShhZ2VudGEpICYmICFhZ2VudGEuaGFzKHIuY29uc2x1c2lvbikpO1xyXG4gICAgICAgIGlmICghcnVsZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm9jZXNzZWQucHVzaChydWxlKTtcclxuICAgICAgICB1bnByb2Nlc3NlZC5kZWxldGUocnVsZSk7XHJcbiAgICAgICAgYWdlbnRhLmFkZChydWxlLmNvbnNsdXNpb24pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHByb2Nlc3NlZDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIEJhY2t3YXJkRGVkdWNlKHJ1bGVzOiBSdWxlW10sIGluaXRpYWw6IHN0cmluZ1tdLCB0YXJnZXQ6IHN0cmluZyk6IFJ1bGVbXSB8IHVuZGVmaW5lZCB7XHJcbiAgICBjb25zdCBhZ2VudGEgPSBuZXcgTWFwPHN0cmluZywgUnVsZXxudWxsPihpbml0aWFsLm1hcChmPT5bZiwgbnVsbF0pKTtcclxuICAgIHJldHVybiBiYWNrd2FyZERlZHVjZShydWxlcywgYWdlbnRhLCB0YXJnZXQpID8gcmVzdG9yZVJlc3VsdChhZ2VudGEsIHRhcmdldCkgOiB1bmRlZmluZWQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlc3RvcmVSZXN1bHQoYWdlbnRhOiBNYXA8c3RyaW5nLCBSdWxlfG51bGw+LCB0YXJnZXQ6IHN0cmluZywgY2FjaGUgPSBuZXcgU2V0PHN0cmluZz4oKSk6IFJ1bGVbXSB7XHJcbiAgICBjb25zdCBydWxlID0gYWdlbnRhLmdldCh0YXJnZXQpO1xyXG4gICAgaWYoIXJ1bGUgfHwgY2FjaGUuaGFzKHRhcmdldCkpXHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgY2FjaGUuYWRkKHRhcmdldCk7XHJcbiAgICByZXR1cm4gcnVsZS5wcmVtaXNlcy5tYXAocD0+cmVzdG9yZVJlc3VsdChhZ2VudGEsIHAsIGNhY2hlKSkucmVkdWNlKChhY2MsIHgpID0+IGFjYy5jb25jYXQoeCksIFtdKS5jb25jYXQoW3J1bGVdKTtcclxufVxyXG5cclxuZnVuY3Rpb24gYmFja3dhcmREZWR1Y2UocnVsZXM6IFJ1bGVbXSwgYWdlbnRhOiBNYXA8c3RyaW5nLCBSdWxlfG51bGw+LCB0YXJnZXQ6IHN0cmluZywgc2VhcmNoOiBTZXQ8c3RyaW5nPiA9IG5ldyBTZXQoKSk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKGFnZW50YS5oYXModGFyZ2V0KSlcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIGlmIChzZWFyY2guaGFzKHRhcmdldCkpXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgc2VhcmNoLmFkZCh0YXJnZXQpO1xyXG4gICAgY29uc3QgY2FuZGlkYXRlcyA9IHJ1bGVzLmZpbHRlcihydWxlID0+IHJ1bGUuY29uc2x1c2lvbiA9PT0gdGFyZ2V0KTtcclxuICAgIG5leHRSdWxlOiBmb3IgKGxldCBpID0gMDsgaSA8IGNhbmRpZGF0ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBjb25zdCBjYW5kaWRhdGVSdWxlID0gY2FuZGlkYXRlc1tpXTtcclxuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNhbmRpZGF0ZVJ1bGUucHJlbWlzZXMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgaWYgKCFiYWNrd2FyZERlZHVjZShydWxlcywgYWdlbnRhLCBjYW5kaWRhdGVSdWxlLnByZW1pc2VzW2pdLCBzZWFyY2gpKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZSBuZXh0UnVsZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBhZ2VudGEuc2V0KHRhcmdldCwgY2FuZGlkYXRlUnVsZSk7XHJcbiAgICAgICAgc2VhcmNoLmRlbGV0ZSh0YXJnZXQpO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgc2VhcmNoLmRlbGV0ZSh0YXJnZXQpO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG59XHJcbiIsIi8vIHNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL2RhbmtsYW1tZXIvYnl0ZXNpemUtaWNvbnNcclxuZXhwb3J0IGNvbnN0IFNWR1BpY3R1cmVzID0ge1xyXG4gICAgRWRpdDogbWFrZVNWRyhgPHBhdGggZD1cIk0zMCA3IEwyNSAyIDUgMjIgMyAyOSAxMCAyNyBaIE0yMSA2IEwyNiAxMSBaIE01IDIyIEwxMCAyNyBaXCIgLz5gLCBcImktZWRpdFwiKSxcclxuICAgIExhbmd1YWdlOiBtYWtlU1ZHKGA8cGF0aCBkPVwiTTEwIDkgTDMgMTcgMTAgMjUgTTIyIDkgTDI5IDE3IDIyIDI1IE0xOCA3IEwxNCAyN1wiIC8+YCwgXCJpLWNvZGVcIiksXHJcbiAgICBEZWxldGU6IG1ha2VTVkcoYDxwYXRoIGQ9XCJNMjggNiBMNiA2IDggMzAgMjQgMzAgMjYgNiA0IDYgTTE2IDEyIEwxNiAyNCBNMjEgMTIgTDIwIDI0IE0xMSAxMiBMMTIgMjQgTTEyIDYgTDEzIDIgMTkgMiAyMCA2XCIgLz5gLCAnaS10cmFzaCcpLFxyXG4gICAgQWRkOiBtYWtlU1ZHKGA8cGF0aCBkPVwiTTE2IDIgTDE2IDMwIE0yIDE2IEwzMCAxNlwiIC8+YCwgJ2ktcGx1cycpXHJcbn07XHJcblxyXG5mdW5jdGlvbiBtYWtlU1ZHKHNvdXJjZTogc3RyaW5nLCBpZDogc3RyaW5nLCBzaXplOiBudW1iZXIgPSAyNCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gYDxzdmcgaWQ9XCIke2lkfVwiIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB2aWV3Qm94PVwiMCAwIDMyIDMyXCIgd2lkdGg9XCIke3NpemV9XCIgaGVpZ2h0PVwiJHtzaXplfVwiIGZpbGw9XCJub25lXCIgc3Ryb2tlPVwiY3VycmVudGNvbG9yXCIgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCIgc3Ryb2tlLXdpZHRoPVwiMVwiPiR7c291cmNlfTwvc3ZnPmBcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIENsaWNrYWJsZVNWR0J1dHRvbiB7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHBhcmVudE5vZGU6IEhUTUxFbGVtZW50LCBzdmc6IHN0cmluZywgb25jbGljazogKCkgPT4gdm9pZCkge1xyXG4gICAgICAgIHRoaXMuYnV0dG9uLmlubmVySFRNTCA9IHN2ZztcclxuICAgICAgICB0aGlzLmJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGV2ID0+IHtcclxuICAgICAgICAgICAgb25jbGljaygpO1xyXG4gICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHBhcmVudE5vZGUuYXBwZW5kKHRoaXMuYnV0dG9uKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgdmlzaWJsZSh2aXNpYmxlOiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5idXR0b24uc3R5bGUuZGlzcGxheSA9IHZpc2libGUgPyBcIlwiIDogXCJub25lXCI7XHJcbiAgICB9XHJcblxyXG4gICAgY2xpY2soKSB7XHJcbiAgICAgICAgdGhpcy5idXR0b24uY2xpY2soKTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IENsaWNrYWJsZVNWR0J1dHRvbiwgU1ZHUGljdHVyZXMgfSBmcm9tIFwiLi9zdmdcIjtcclxuXHJcbmV4cG9ydCBlbnVtIERpcmVjdGlvbiB7IEZvcndhcmQsIEJhY2t3YXJkIH1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVGYWN0c1NlbGVjdG9yKG5hbWVzOiBNYXA8c3RyaW5nLCBzdHJpbmc+LCBjaG9vc2VkOiAoZGlyOiBEaXJlY3Rpb24sIGluaXRpYWxGYWN0czogQXJyYXk8c3RyaW5nPiwgdGFyZ2V0RmFjdDogc3RyaW5nKSA9PiB2b2lkKSB7XHJcbiAgICBjb25zdCBjaG9vc2VJdGVtcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJmb3JtXCIpO1xyXG4gICAgY2hvb3NlSXRlbXMuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXYpID0+IGV2LnByZXZlbnREZWZhdWx0KCkpO1xyXG4gICAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImhlYWRlclwiKTtcclxuICAgIGhlYWRlci5pbm5lclRleHQgPSBcItCk0LDQutGC0YtcIlxyXG4gICAgaGVhZGVyLnRpdGxlID0gXCIo0JvQmtCcIC0g0LrQsNC6INC90LDRh9Cw0LvRjNC90YvQuSDRhNCw0LrRgiwg0J/QmtCcIC0g0LrQsNC6INC40YHQutC+0LzRi9C5KVwiO1xyXG4gICAgY29uc3QgaXRlbXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJ0aWNsZVwiKTtcclxuICAgIGl0ZW1zLmNsYXNzTGlzdC5hZGQoXCJzZWxlY3RhYmxlLWxpc3RcIik7XHJcbiAgICBjb25zdCBpbml0aWFsSW5wdXRzID0gbmV3IEFycmF5PEhUTUxJbnB1dEVsZW1lbnQ+KCk7XHJcbiAgICBjb25zdCB0YXJnZXRJbnB1dHMgPSBuZXcgQXJyYXk8SFRNTElucHV0RWxlbWVudD4oKTtcclxuICAgIG5ldyBDbGlja2FibGVTVkdCdXR0b24oaGVhZGVyLCBTVkdQaWN0dXJlcy5EZWxldGUsICgpID0+IEFycmF5PEhUTUxJbnB1dEVsZW1lbnQ+KCkuY29uY2F0KGluaXRpYWxJbnB1dHMsIHRhcmdldElucHV0cykuZm9yRWFjaChpbnB1dCA9PiBpbnB1dC5jaGVja2VkID0gZmFsc2UpKVxyXG4gICAgaXRlbXMuYXBwZW5kKC4uLkFycmF5LmZyb20obmFtZXMuZW50cmllcygpKVxyXG4gICAgICAgIC5zb3J0KChhLCBiKSA9PiBhWzFdLmxvY2FsZUNvbXBhcmUoYlsxXSkpXHJcbiAgICAgICAgLm1hcCgoW2lkLCBuYW1lXSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBsaW5lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNlY3Rpb25cIik7XHJcbiAgICAgICAgICAgIGxpbmUuY2xhc3NMaXN0LmFkZCgnc2VsZWN0YWJsZS1saW5lJyk7XHJcbiAgICAgICAgICAgIGxpbmUudGl0bGUgPSBpZDtcclxuICAgICAgICAgICAgY29uc3QgaXNJbml0aWFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xyXG4gICAgICAgICAgICBpc0luaXRpYWwudmFsdWUgPSBpZDtcclxuICAgICAgICAgICAgaXNJbml0aWFsLm5hbWUgPSBcImlzSW5pdGlhbFwiO1xyXG4gICAgICAgICAgICBpc0luaXRpYWwudHlwZSA9IFwiY2hlY2tib3hcIjtcclxuICAgICAgICAgICAgY29uc3QgaXNUYXJnZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XHJcbiAgICAgICAgICAgIGlzVGFyZ2V0LnZhbHVlID0gaWQ7XHJcbiAgICAgICAgICAgIGlzVGFyZ2V0Lm5hbWUgPSBcImlzVGFyZ2V0XCI7XHJcbiAgICAgICAgICAgIGlzVGFyZ2V0LnR5cGUgPSBcInJhZGlvXCI7XHJcbiAgICAgICAgICAgIGxpbmUuYXBwZW5kKGlzSW5pdGlhbCwgbmFtZSwgaXNUYXJnZXQpO1xyXG4gICAgICAgICAgICBpbml0aWFsSW5wdXRzLnB1c2goaXNJbml0aWFsKTtcclxuICAgICAgICAgICAgdGFyZ2V0SW5wdXRzLnB1c2goaXNUYXJnZXQpO1xyXG4gICAgICAgICAgICBsaW5lLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIChldjogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGV2LnRhcmdldCAhPSBsaW5lKSByZXR1cm5cclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoZXYuYnV0dG9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNJbml0aWFsLmNoZWNrZWQgPSAhaXNJbml0aWFsLmNoZWNrZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1RhcmdldC5jaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzVGFyZ2V0LmNoZWNrZWQgPSAhaXNUYXJnZXQuY2hlY2tlZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzSW5pdGlhbC5jaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgbGluZS5hZGRFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgKGV2KSA9PiBldi5wcmV2ZW50RGVmYXVsdCgpKTtcclxuICAgICAgICAgICAgcmV0dXJuIGxpbmU7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgY29uc3QgY3JlYXRlRXZlbnQgPSAoZGlyOiBEaXJlY3Rpb24pID0+IHtcclxuICAgICAgICByZXR1cm4gKGV2OiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldEZhY3QgPSB0YXJnZXRJbnB1dHMuZmluZCgoaW5wdXQpID0+IGlucHV0LmNoZWNrZWQpO1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0RmFjdCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBhbGVydChcItCS0YvQsdC10YDQuNGC0LUg0YbQtdC70LXQstC+0Lkg0YTQsNC60YJcIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgaW5pdGlhbEZhY3RzID0gaW5pdGlhbElucHV0cy5maWx0ZXIoKGlucHV0KSA9PiBpbnB1dC5jaGVja2VkKTtcclxuICAgICAgICAgICAgaWYgKGluaXRpYWxGYWN0cy5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgYWxlcnQoXCLQktGL0LHQtdGA0LjRgtC1INC90LDRh9Cw0LvRjNC90YvQtSDRhNCw0LrRgtGLXCIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IGluaXRpYWxGYWN0c0lkcyA9IGluaXRpYWxGYWN0cy5tYXAoaSA9PiBpLnZhbHVlKTtcclxuICAgICAgICAgICAgY29uc3QgdGFyZ2V0RmFjdElkID0gdGFyZ2V0RmFjdC52YWx1ZTtcclxuICAgICAgICAgICAgY29uc3QganNvblNuYXBzaG90ID0gSlNPTi5zdHJpbmdpZnkoeyBpbml0aWFsOiBpbml0aWFsRmFjdHNJZHMsIHRhcmdldDogdGFyZ2V0RmFjdElkIH0pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhqc29uU25hcHNob3QpXHJcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImxhc3RcIiwganNvblNuYXBzaG90KVxyXG4gICAgICAgICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHdpbmRvdy5sb2NhdGlvbi5ocmVmKVxyXG4gICAgICAgICAgICB1cmwuc2VhcmNoUGFyYW1zLnNldChcImRhdGFcIiwgdXRmOF90b19iNjQoanNvblNuYXBzaG90KSlcclxuICAgICAgICAgICAgaGlzdG9yeS5wdXNoU3RhdGUobnVsbCwgXCJcIiwgdXJsLnRvU3RyaW5nKCkpXHJcbiAgICAgICAgICAgIGNob29zZWQoZGlyLCBpbml0aWFsRmFjdHNJZHMsIHRhcmdldEZhY3RJZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZmV0Y2hMb2NhbFN0b3JhZ2UoXCJsYXN0XCIpLnRoZW4oKHsgaW5pdGlhbCwgdGFyZ2V0IH06IHsgaW5pdGlhbDogc3RyaW5nW10sIHRhcmdldDogc3RyaW5nIH0pID0+IHtcclxuICAgICAgICBjb25zdCBzYXZlZEluaXRpYWwgPSBuZXcgU2V0KGluaXRpYWwpO1xyXG4gICAgICAgIGluaXRpYWxJbnB1dHMuZmlsdGVyKGYgPT4gc2F2ZWRJbml0aWFsLmhhcyhmLnZhbHVlKSkuZm9yRWFjaChpbnB1dCA9PiBpbnB1dC5jaGVja2VkID0gdHJ1ZSk7XHJcbiAgICAgICAgdGFyZ2V0SW5wdXRzLmZpbHRlcihmID0+IGYudmFsdWUgPT09IHRhcmdldCkuZm9yRWFjaChpbnB1dCA9PiBpbnB1dC5jaGVja2VkID0gdHJ1ZSk7XHJcbiAgICB9KVxyXG4gICAgY29uc3QgZm9vdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImZvb3RlclwiKTtcclxuICAgIGZvb3Rlci5hcHBlbmQoLi4uW1tcItCf0YDRj9C80L7QuVwiLCBEaXJlY3Rpb24uRm9yd2FyZF0sIFtcItCe0LHRgNCw0YLQvdGL0LlcIiwgRGlyZWN0aW9uLkJhY2t3YXJkXV0ubWFwKChbbmFtZSwgZGlyXSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICAgICAgYnV0dG9uLmlubmVyVGV4dCA9IG5hbWUgYXMgc3RyaW5nO1xyXG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY3JlYXRlRXZlbnQoZGlyIGFzIERpcmVjdGlvbikpO1xyXG4gICAgICAgIHJldHVybiBidXR0b247XHJcbiAgICB9KSk7XHJcbiAgICBjaG9vc2VJdGVtcy5hcHBlbmQoaGVhZGVyLCBpdGVtcywgZm9vdGVyKTtcclxuICAgIHJldHVybiBjaG9vc2VJdGVtcztcclxufVxyXG5cclxuZnVuY3Rpb24gZmV0Y2hMb2NhbFN0b3JhZ2Uoa2V5OiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHdpbmRvdy5sb2NhdGlvbi5ocmVmKVxyXG4gICAgICAgIGNvbnN0IHBhcmFtID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoXCJkYXRhXCIpXHJcbiAgICAgICAgaWYocGFyYW0pIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGpzb24gPSBiNjRfdG9fdXRmOChwYXJhbSlcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGpzb24pXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShKU09OLnBhcnNlKGpzb24pKVxyXG4gICAgICAgICAgICB9IGNhdGNoKGUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICBpZiAodmFsdWUpXHJcbiAgICAgICAgICAgIHJlc29sdmUoSlNPTi5wYXJzZSh2YWx1ZSkpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHV0ZjhfdG9fYjY0KHN0cjogc3RyaW5nKTogc3RyaW5nIHtcclxuXHRyZXR1cm4gd2luZG93LmJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHN0cikpKTtcclxufVxyXG5cclxuZnVuY3Rpb24gYjY0X3RvX3V0Zjgoc3RyOiBzdHJpbmcpOiBzdHJpbmcge1xyXG5cdHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKHdpbmRvdy5hdG9iKHN0cikpKTtcclxufSIsImltcG9ydCB7IEJhY2t3YXJkRGVkdWNlLCBGb3J3YXJkRGVkdWNlLCBSdWxlIH0gZnJvbSBcIi4vZGVkdWNlc1wiO1xuaW1wb3J0IHsgY3JlYXRlRmFjdHNTZWxlY3RvciwgRGlyZWN0aW9uIH0gZnJvbSBcIi4vZmFjdHNfc2VsZWN0b3JcIjtcbmltcG9ydCB7IGZldGNoVHh0IH0gZnJvbSBcIi4vaHR0cF9oZWxwZXJzXCI7XG5pbXBvcnQgXCIuL3N0eWxlLnNjc3NcIlxuXG5Qcm9taXNlLmFsbChcbiAgICBbXCJTdWJzdGFuY2VzXCIsIFwiQ2hlbWlzdHJ5XCJdLlxuICAgICAgICBtYXAoeCA9PiBgLi9yZXNvdXJjZXMvJHt4fS50eHRgKS5cbiAgICAgICAgbWFwKGZldGNoVHh0KVxuKS50aGVuKChbc3Vic3RhbmNlcywgcmVhY3Rpb25zXSkgPT4ge1xuICAgIGNvbnN0IGZhY3RzID0gbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKTtcbiAgICBjb25zdCBub3RGb3VuZCA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgIHN1YnN0YW5jZXMuc3BsaXQoJ1xcbicpLlxuICAgICAgICBmaWx0ZXIoeCA9PiB4LnRyaW0oKSAhPSBcIlwiKS5cbiAgICAgICAgbWFwKHMgPT4gcy5zcGxpdChcIiAtPiBcIikpLlxuICAgICAgICBmb3JFYWNoKHBhaXIgPT4gZmFjdHMuc2V0KHBhaXJbMF0udHJpbSgpLCBwYWlyWzFdLnRyaW0oKSkpO1xuICAgIHJlYWN0aW9ucy5tYXRjaCgvW0EtWmEtetChMC050JAt0K/QsC3RjygpXSsvZyk/LmZvckVhY2goKHN1YnN0cikgPT4ge1xuICAgICAgICBjb25zdCBuYW1lID0gZmFjdHMuZ2V0KHN1YnN0cik7XG4gICAgICAgIGlmICghbmFtZSkge1xuICAgICAgICAgICAgbm90Rm91bmQuYWRkKHN1YnN0cik7XG4gICAgICAgICAgICBmYWN0cy5zZXQoc3Vic3RyLCBzdWJzdHIpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgY29uc3QgcnVsZXMgPSByZWFjdGlvbnMuc3BsaXQoJ1xcbicpLm1hcCh4ID0+IHgudHJpbSgpKS5maWx0ZXIoeCA9PiB4ICE9IFwiXCIpLm1hcCgocmF3UnVsZSkgPT4ge1xuICAgICAgICBjb25zdCBbcHJlbWlzZXMsIGNvbmNsdXNpb25zXSA9IHJhd1J1bGUuc3BsaXQoXCIgLT4gXCIpLm1hcCh4ID0+IHguc3BsaXQoXCIrXCIpLm1hcCh4ID0+IHgudHJpbSgpKSk7XG4gICAgICAgIHJldHVybiBjb25jbHVzaW9ucy5tYXAoYyA9PiBuZXcgUnVsZShwcmVtaXNlcywgYywgcmF3UnVsZSkpO1xuICAgIH0pLnJlZHVjZSgoYWNjLCB4KSA9PiBhY2MuY29uY2F0KHgpLCBbXSk7XG4gICAgcnVsZXMuc29ydCgoYSwgYik9PmEucHJlbWlzZXMubGVuZ3RoLWIucHJlbWlzZXMubGVuZ3RoKTtcbiAgICBjb25zdCBzdHlsZVNoZWV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInN0eWxlXCIpO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc3R5bGVTaGVldCk7XG4gICAgY29uc3Qgb3V0cHV0QXJ0aWNsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcnRpY2xlXCIpO1xuICAgIGNvbnN0IG91dHB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcnRpY2xlXCIpO1xuICAgIGNvbnN0IG91dHB1dEhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoZWFkZXJcIik7XG4gICAgY29uc3Qgb3V0cHV0Rm9vdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNlY3Rpb25cIik7XG4gICAgY29uc3QgZm9vdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImZvb3RlclwiKTtcbiAgICBjb25zdCBzZWVSdWxlcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgc2VlUnVsZXMudGV4dENvbnRlbnQgPSBcItCS0YHQtSDQv9GA0LDQstC40LvQsFwiO1xuICAgIHNlZVJ1bGVzLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBwcmludFJ1bGVzKGZhY3RzLCBydWxlcywgb3V0cHV0LCBvdXRwdXRGb290ZXIsIHN0eWxlU2hlZXQpKVxuICAgIGZvb3Rlci5hcHBlbmQob3V0cHV0Rm9vdGVyLCBzZWVSdWxlcyk7XG4gICAgb3V0cHV0SGVhZGVyLnRleHRDb250ZW50ID0gXCLQktGL0LLQvtC0OlwiO1xuICAgIG91dHB1dEFydGljbGUuYXBwZW5kKG91dHB1dEhlYWRlciwgb3V0cHV0LCBmb290ZXIpXG4gICAgb3V0cHV0QXJ0aWNsZS5pZCA9IFwib3V0cHV0XCI7XG4gICAgY29uc3QgY2hvb3NlSXRlbXMgPSBjcmVhdGVGYWN0c1NlbGVjdG9yKGZhY3RzLCAoZGlyLCBpbml0aWFsLCB0YXJnZXQpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG91dHB1dC5pbm5lckhUTUwgPSBcIlwiO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZGlyID09IERpcmVjdGlvbi5Gb3J3YXJkID8gRm9yd2FyZERlZHVjZShydWxlcywgaW5pdGlhbCwgdGFyZ2V0KSA6IEJhY2t3YXJkRGVkdWNlKHJ1bGVzLCBpbml0aWFsLCB0YXJnZXQpO1xuICAgICAgICAgICAgaWYgKHJlc3VsdClcbiAgICAgICAgICAgICAgICBwcmludFJ1bGVzKGZhY3RzLCByZXN1bHQsIG91dHB1dCwgb3V0cHV0Rm9vdGVyLCBzdHlsZVNoZWV0LCBuZXcgU2V0KGluaXRpYWwpKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBvdXRwdXRGb290ZXIudGV4dENvbnRlbnQgPSBcItCd0LUg0LLRi9Cy0L7QtNC40LzQvlwiO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBvdXRwdXRGb290ZXIudGV4dENvbnRlbnQgPSBlIGFzIGFueTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIG91dHB1dC5pbm5lckhUTUwgPSBgPGRpdiBzdHlsZT1cInRleHQtYWxpZ246IGNlbnRlcjtcIj7QodC/0YDQsNCy0LAg0LzQvtC20L3QviDQstGL0LHRgNCw0YLRjCDQvdCw0YfQsNC70YzQvdGL0LUg0YTQsNC60YLRiyDQuCDQutC+0L3QtdGH0L3Ri9C5INGE0LDQutGCICjRgSDQv9C+0LzQvtGJ0YzRjiDRh9C10LrQsdC+0LrRgdC+0LIg0LjQu9C4INCb0JrQnCDQuCDQn9Ca0Jwg0L/QviDRgdGC0YDQvtGH0LrQtSkuPGRpdj5gO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJhcnRpY2xlXCIpIS5hcHBlbmQob3V0cHV0QXJ0aWNsZSwgY2hvb3NlSXRlbXMpO1xufSk7XG5cbmZ1bmN0aW9uIHByaW50UnVsZXMoZmFjdHM6IE1hcDxzdHJpbmcsIHN0cmluZz4sIHJlc3VsdDogUnVsZVtdLCBvdXRwdXQ6IEhUTUxFbGVtZW50LCBvdXRwdXRGb290ZXI6IEhUTUxFbGVtZW50LCBzdHlsZVNoZWV0OiBIVE1MU3R5bGVFbGVtZW50LCBpbml0aWFsU2V0PzogU2V0PHN0cmluZz4pIHtcbiAgICBvdXRwdXQuaW5uZXJIVE1MID0gXCJcIjtcbiAgICBjb25zdCBmYWN0VG9TcGFuID0gKGZhY3RJZDogc3RyaW5nKSA9PiB7XG4gICAgICAgIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICAgICAgd3JhcHBlci50ZXh0Q29udGVudCA9IGZhY3RzLmdldChmYWN0SWQpITtcbiAgICAgICAgY29uc3Qgc2VyaWFsaXplZElkID0gZmFjdElkLnJlcGxhY2UoL1spKF0vZywgJ18nKVxuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoc2VyaWFsaXplZElkKTtcbiAgICAgICAgaWYgKGluaXRpYWxTZXQ/LmhhcyhmYWN0SWQpKSB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoXCJpbml0aWFsLWZhY3RcIik7XG4gICAgICAgIHdyYXBwZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZW50ZXJcIiwgKCkgPT4gc3R5bGVTaGVldC50ZXh0Q29udGVudCA9IGAuJHtzZXJpYWxpemVkSWR9IHsgYmFja2dyb3VuZC1jb2xvcjogIzM4M2E0MjsgZm9udC13ZWlnaHQ6IDcwMDsgfSAucmVhY3Rpb24gPiAuJHtzZXJpYWxpemVkSWR9IHsgb3V0bGluZTogZGFzaGVkIDJweCBsaW1lOyB9YCk7XG4gICAgICAgIC8vIHdyYXBwZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgKCkgPT4geyBpZiAoc3R5bGVTaGVldC50ZXh0Q29udGVudD8ubWF0Y2goc2VyaWFsaXplZElkKSkgc3R5bGVTaGVldC50ZXh0Q29udGVudCA9IFwiXCI7IH0pO1xuICAgICAgICByZXR1cm4gd3JhcHBlcjtcbiAgICB9XG4gICAgb3V0cHV0LmFwcGVuZCguLi5yZXN1bHQubWFwKHIgPT4ge1xuICAgICAgICBjb25zdCByZWFjdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHJlYWN0aW9uLnRpdGxlID0gci5vcmlnaW47XG4gICAgICAgIHJlYWN0aW9uLmNsYXNzTGlzdC5hZGQoXCJyZWFjdGlvblwiKTtcbiAgICAgICAgcmVhY3Rpb24uYXBwZW5kKC4uLnIucHJlbWlzZXMubWFwKGZhY3RUb1NwYW4pLnJlZHVjZSgoYWNjLCBuZXh0KSA9PiBhY2MubGVuZ3RoID8gYWNjLmNvbmNhdChcIiArIFwiLCBuZXh0KSA6IFtuZXh0XSwgbmV3IEFycmF5PE5vZGUgfCBzdHJpbmc+KCkpKVxuICAgICAgICByZWFjdGlvbi5hcHBlbmQoXCIg4oaSIFwiLCBmYWN0VG9TcGFuKHIuY29uc2x1c2lvbikpXG4gICAgICAgIHJlYWN0aW9uLmNsYXNzTGlzdC5hZGQoci5jb25zbHVzaW9uLnJlcGxhY2UoL1spKF0vZywgJ18nKSk7XG4gICAgICAgIHJldHVybiByZWFjdGlvbjtcbiAgICB9KSlcbiAgICBvdXRwdXRGb290ZXIudGV4dENvbnRlbnQgPSBg0J/RgNCw0LLQuNC7OiAke3Jlc3VsdC5sZW5ndGh9YFxufSIsImV4cG9ydCBmdW5jdGlvbiBmZXRjaEpTT04odXJsOiBSZXF1ZXN0SW5mbyk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIGZldGNoKHVybCxcbiAgICAgICAge1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZmV0Y2hUeHQodXJsOiBSZXF1ZXN0SW5mbyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgcmV0dXJuIGZldGNoKHVybCxcbiAgICAgICAge1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ3RleHQvcGxhaW4nXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UudGV4dCgpKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZmV0Y2hJbWFnZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPEltYWdlQml0bWFwU291cmNlPlxue1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpXG4gICAge1xuICAgICAgICBsZXQgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGltZyk7XG4gICAgICAgIH07XG4gICAgICAgIGltZy5vbmVycm9yID0gZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KG5hbWUpO1xuICAgICAgICB9O1xuICAgICAgICBpbWcuc3JjID0gYC9yZXNvdXJjZXMvaW1hZ2VzLyR7bmFtZX1gO1xuICAgIH0pO1xufSJdLCJzb3VyY2VSb290IjoiIn0=